services:
  backend:
    build: ./backend
    container_name: poubelle-backend
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - JWT_SECRET=${JWT_SECRET}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASS=${SMTP_PASS}
      - ADMIN_EMAIL=${ADMIN_EMAIL}
    volumes:
      - sqlite-data:/app/data
    networks:
      - app-network

  frontend:
    build: ./frontend
    container_name: poubelle-frontend
    restart: unless-stopped
    depends_on:
      - backend
    networks:
      - app-network
      - traefik-network
    labels:
      - traefik.enable=true
      - traefik.http.routers.poubelle.rule=Host(`planningpoubelle.duckdns.org`)
      - traefik.http.routers.poubelle.tls=true
      - traefik.http.routers.poubelle.entrypoints=websecure
      - traefik.http.routers.poubelle.tls.certresolver=mytlschallenge
      - traefik.http.services.poubelle.loadbalancer.server.port=80

volumes:
  sqlite-data:

networks:
  app-network:
    driver: bridge
  traefik-network:
    external: true
    name: root_default
